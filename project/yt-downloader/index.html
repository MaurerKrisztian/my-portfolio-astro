<!DOCTYPE html><link rel="stylesheet" href="/assets/b811418b.5864f3d6.css" />
<link rel="stylesheet" href="/assets/901a9090.6c3cc81b.css" /><script type="module" src="/hoisted.e681e719.js"></script><html lang="en" class="astro-FNBAIWJC">
	<head>
		<meta charset="UTF-8">

<meta name="title" property="og:title" content="Maurer Kriszti√°n: Personal Site">
<meta name="description" property="og:description" content="Hi , I'm Maurer Krisztian ¬∑ A passionate full stack developer from Hungary ¬∑ Connect with me: ¬∑ CV: ¬∑ Blog: ¬∑ Discord: ¬∑ Languages and Tools:.">
<meta property="og:image" content="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/8sm83mcibpxa0giedjfo.jpg">

<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="generator" content="Astro v1.0.3">
<title>Youtube downloader (cli wrapper)</title>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-7EC4B0NZ4G"></script>


<link rel="icon" type="image/x-icon" href="/favicon.ico">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@200;400;700;900&display=swap" rel="stylesheet">

		
	<link rel="stylesheet" href="/assets/b811418b.5864f3d6.css" />
<link rel="stylesheet" href="/assets/901a9090.6c3cc81b.css" /><script type="module" src="/hoisted.e681e719.js"></script></head>
	<body class="astro-FNBAIWJC">
		<nav class="_nav_1tpto_1"><a class="_logolink_1tpto_11" href="/"><div class="_monogram_1tpto_31">MK</div></a><a class="_link_1tpto_17" href="/">Home</a><a class="_link_1tpto_17" href="/projects">Portfolio</a><a class="_link_1tpto_17" href="/blog">Blog</a><a class="_link_1tpto_17" href="/contact">Contact me</a></nav>
		<header style="background-image:url(/assets/project/Maurer_Kriszti√°n_yt-downloader-cover.png)" class="hero astro-FNBAIWJC">
			<h1 class="title astro-FNBAIWJC">Youtube downloader (cli wrapper)</h1>
		</header>
		<div class="leadIn astro-FNBAIWJC">
			<div class="wrapper pt8 pb8 mb8 tac astro-FNBAIWJC">
				<span class="tag astro-FNBAIWJC">HTML Canvas</span><span class="tag astro-FNBAIWJC">UI</span><span class="tag astro-FNBAIWJC">Animation</span>
				<h3 class="tagline astro-FNBAIWJC">Youtube downloader (cli wrapper)</h3>
			</div>
		</div>
		<div class="wrapper wrapper__readable astro-FNBAIWJC">
			<div class="content astro-FNBAIWJC"><p><img src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/g49qupi8c5g5f5uv5t4q.gif" alt="Youtube downloader demo Maurer Kriszti√°n"></p>
<p>You have probably already come across a YouTube video download site, in this article I will show you how to write such a site and go through the concepts and solutions I used.</p>
<h3 id="first-of-all-lets-clarify-what-we-want-to-achieve">First of all, let‚Äôs clarify what we want to achieve:</h3>
<ul>
<li>providing a youtube link to download the video in mp4 or mp3 format and give real time feedback on the status of the download to make it cool.</li>
</ul>
<p>Demo: <a href="https://youtube-downloader-app.netlify.app/">https://youtube-downloader-app.netlify.app/</a></p>
<p>Api code: <a href="https://github.com/MaurerKrisztian/youtube-downloader-api">https://github.com/MaurerKrisztian/youtube-downloader-api</a></p>
<p>UI code: <a href="https://github.com/MaurerKrisztian/youtube-downloader-ui-vue">https://github.com/MaurerKrisztian/youtube-downloader-ui-vue</a></p>
<h3 id="1-how-to-download-a-youtube-video"><strong>1. How to download a youtube video?</strong></h3>
<p>After a bit of searching, I found a couple of Linux cli tools that are just for this, most of them downloaded slowly, but luckily I found <strong><a href="https://github.com/yt-dlp/yt-dlp">ytb-dl</a></strong>, which somehow bypasses the download restriction.</p>
<h3 id="2-how-to-interact-with-a-cli-api-via-nodejs"><strong>2. How to interact with a cli API via Node.js?</strong></h3>
<p>With nodejs you can run cli commands with the <a href="https://nodejs.org/api/child_process.html"><strong>spawn</strong></a> built-in function that creates a child process.</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">downloadProcess</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">spawn</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'yt-dlp'</span><span style="color: #C9D1D9">, [link]);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">downloadProcess.stdout.</span><span style="color: #D2A8FF">on</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'data'</span><span style="color: #C9D1D9">, (</span><span style="color: #FFA657">data</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">    console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(data);</span></span>
<span class="line"><span style="color: #C9D1D9">});</span></span></code></pre>
<p>The responses of the child process to the console, e.g. download percentage, speed, size‚Ä¶ we can receive and process these outputs with stdout.on</p>
<h3 id="3-cli-wrapper"><strong>3. CLI wrapper.</strong></h3>
<p>I built a wrapper around yt-dlp which essentially parameterizes the calls and formats the lines extracted from std-otut into json format with a couple of regexps so I can easily work with this in the future.</p>
<p><strong>Events:</strong> The wrapper throws 4 types of events:</p>
<ul>
<li>start - when a download starts</li>
<li>progress - information about the download progress (precent, speed..)</li>
<li>error - if something went wrong</li>
<li>close - if the process has ended</li>
</ul>
<p>Wrapper file: <a href="https://github.com/MaurerKrisztian/youtube-downloader-api/blob/main/src/cli-wrapper/yt-downloader-wrapper.ts">https://github.com/MaurerKrisztian/youtube-downloader-api/blob/main/src/cli-wrapper/yt-downloader-wrapper.ts</a></p>
<p>As a result, this function call can be used to start a download of throw events from cli responses into a processable format:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"></span>
<span class="line"><span style="color: #C9D1D9">¬†</span><span style="color: #D2A8FF">process</span><span style="color: #C9D1D9">(link: string, id: string, path: string </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'./download'</span><span style="color: #C9D1D9">, filename: string </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">"video"</span><span style="color: #C9D1D9">, format: </span><span style="color: #A5D6FF">'mp4'</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">|</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'mp3'</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'mp4'</span><span style="color: #C9D1D9">) {</span><span style="color: #FF7B72">...</span><span style="color: #C9D1D9">}</span></span>
<span class="line"></span></code></pre>
<h3 id="4-event-management"><strong>4. Event management</strong></h3>
<p>On the UI, the goal would be to have real-time feedback, so a REST API solution is not suitable, but the websocket is perfet, so I built a socket connection, the client can request a download and can subscribe to progress, error, done response that sends real time information.</p>
<h3 id="5-ui"><strong>5. UI</strong></h3>
<p>I‚Äôm writing UI in Vue (my first vue project). It essentially connects to the backend sockets and displays the returned data.</p>
<h3 id="6-deploy"><strong>6. Deploy</strong></h3>
<p>We use the yt-dlp cli so the env need to contain this. I was able to deploy it to my own server, but I also tried to deploy here <a href="https://railway.app/">https://railway.app/</a> but this yt-dlp is a ‚Äúbanned dependency‚Äù due to the quality of shared hosting but we can include the yt-dlp binary among the files and use that or downolad the binary on the fly. I am currently working on it.</p>
<p>*NOTE: this is just an mvp (there are things to improve) in the future I will update the article and the project, if you find something to improve, feel free to submit a pull request or open an issue</p></div>
		</div>
		<footer class="tac mt6 astro-FNBAIWJC">
			<a href="/projects" class="astro-FNBAIWJC">
				<span class="_button_1fbb5_1">View More</span>
			</a>
		</footer>
		<footer class="_footer_knfx6_1">¬© 2022 Maurer Kriszti√°n<small class="_byline_knfx6_9">üöÄ Built by Astro</small></footer>
	</body></html>