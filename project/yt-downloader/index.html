<!DOCTYPE html><link rel="stylesheet" href="/assets/d6540413.f70babb3.css" />
<link rel="stylesheet" href="/assets/901a9090.6c3cc81b.css" /><html lang="en" class="astro-FNBAIWJC">
	<head>
		<meta charset="UTF-8">
<meta name="description" property="og:description" content="The goal of this project is to make a cool background with randomized shapes and to be customizable.">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Astro v1.0.3">
<title>Youtube downloader (cli wrapper)</title>

<link rel="icon" type="image/x-icon" href="/favicon.ico">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@200;400;700;900&display=swap" rel="stylesheet">

		
	<link rel="stylesheet" href="/assets/d6540413.f70babb3.css" />
<link rel="stylesheet" href="/assets/901a9090.6c3cc81b.css" /></head>
	<body class="astro-FNBAIWJC">
		<nav class="_nav_7dyb5_1"><a class="_logolink_7dyb5_10" href="/"><div class="_monogram_7dyb5_30">JW</div></a><a class="_link_7dyb5_16" href="/projects">Portfolio</a><a class="_link_7dyb5_16" href="/works">Works</a><a class="_link_7dyb5_16" href="/about">About</a><a class="_social_7dyb5_44" href="https://github.com/MaurerKrisztian"><svg class="_socialicon_7dyb5_52" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path></svg></a><a class="_social_7dyb5_44" href="https://dev.to/maurerkrisztian"><svg class="_socialicon_7dyb5_52" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 40" style="enable-background:new 0 0 50 40" xmlSpace="preserve"><path d="M15.7 15.5c-.4-.3-.7-.4-1.1-.4h-1.7v10.1h1.7c.4 0 .8-.1 1.1-.4.4-.3.6-.7.6-1.3v-6.7c0-.6-.2-1-.6-1.3z"></path><path d="M47 0H3C1.3 0 0 1.3 0 3v34c0 1.7 1.3 3 3 3h44c1.7 0 3-1.3 3-3V3c0-1.7-1.3-3-3-3zM19.1 23.5c0 1.3-.4 2.4-1.3 3.2-.8.9-1.9 1.3-3.3 1.3h-4.4V12.3h4.5c1.3 0 2.4.4 3.2 1.3.8.8 1.3 1.9 1.3 3.2v6.7zm9.1-8.4h-5.1v3.6h3.1v2.8h-3.1v3.7h5.1V28h-5.9c-.6 0-1-.2-1.4-.6-.4-.4-.6-.8-.6-1.4V14.2c0-.6.2-1 .6-1.4.4-.4.8-.6 1.4-.6h5.9v2.9zM37.5 26c-.6 1.3-1.3 2-2.2 2-.9 0-1.7-.7-2.2-2l-3.7-13.8h3.1L35.3 23l2.8-10.8h3.1L37.5 26z"></path></svg></a><a class="_social_7dyb5_44" target="_blank" href="https://profile.codersrank.io/user/maurerkrisztian"><img class="_socialicon_7dyb5_52" src="assets/icons/codersrank-blue.svg" /></a><a class="_social_7dyb5_44" target="_blank" href="https://hashnode.com/@maurerkrisztian"><img class="_socialicon_7dyb5_52" src="assets/icons/hashnode-svgrepo-com.svg" /></a><a class="_social_7dyb5_44" target="_blank" href="https://www.linkedin.com/in/kriszti%C3%A1n-maurer-7681a6192/"><svg class="_socialicon_7dyb5_52" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"></path></svg></a></nav>
		<header style="background-image:url(/assets/project/yt-downloader-cover.png)" class="hero astro-FNBAIWJC">
			<h1 class="title astro-FNBAIWJC">Youtube downloader (cli wrapper)</h1>
		</header>
		<div class="leadIn astro-FNBAIWJC">
			<div class="wrapper pt8 pb8 mb8 tac astro-FNBAIWJC">
				<span class="tag astro-FNBAIWJC">HTML Canvas</span><span class="tag astro-FNBAIWJC">UI</span><span class="tag astro-FNBAIWJC">Animation</span>
				<h3 class="tagline astro-FNBAIWJC">The goal of this project is to make a cool background with randomized shapes and to be customizable.</h3>
			</div>
		</div>
		<div class="wrapper wrapper__readable astro-FNBAIWJC">
			<div class="content astro-FNBAIWJC"><p><img src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/g49qupi8c5g5f5uv5t4q.gif" alt="Youtube downloader demo"></p>
<p>You have probably already come across a YouTube video download site, in this article I will show you how to write such a site and go through the concepts and solutions I used.</p>
<h3 id="first-of-all-lets-clarify-what-we-want-to-achieve">First of all, let’s clarify what we want to achieve:</h3>
<ul>
<li>providing a youtube link to download the video in mp4 or mp3 format and give real time feedback on the status of the download to make it cool.</li>
</ul>
<p>Demo: <a href="https://youtube-downloader-app.netlify.app/">https://youtube-downloader-app.netlify.app/</a></p>
<p>Api code: <a href="https://github.com/MaurerKrisztian/youtube-downloader-api">https://github.com/MaurerKrisztian/youtube-downloader-api</a></p>
<p>UI code: <a href="https://github.com/MaurerKrisztian/youtube-downloader-ui-vue">https://github.com/MaurerKrisztian/youtube-downloader-ui-vue</a></p>
<h3 id="1-how-to-download-a-youtube-video"><strong>1. How to download a youtube video?</strong></h3>
<p>After a bit of searching, I found a couple of Linux cli tools that are just for this, most of them downloaded slowly, but luckily I found <strong><a href="https://github.com/yt-dlp/yt-dlp">ytb-dl</a></strong>, which somehow bypasses the download restriction.</p>
<h3 id="2-how-to-interact-with-a-cli-api-via-nodejs"><strong>2. How to interact with a cli API via Node.js?</strong></h3>
<p>With nodejs you can run cli commands with the <a href="https://nodejs.org/api/child_process.html"><strong>spawn</strong></a> built-in function that creates a child process.</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">downloadProcess</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">spawn</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'yt-dlp'</span><span style="color: #C9D1D9">, [link]);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">downloadProcess.stdout.</span><span style="color: #D2A8FF">on</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'data'</span><span style="color: #C9D1D9">, (</span><span style="color: #FFA657">data</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">    console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(data);</span></span>
<span class="line"><span style="color: #C9D1D9">});</span></span></code></pre>
<p>The responses of the child process to the console, e.g. download percentage, speed, size… we can receive and process these outputs with stdout.on</p>
<h3 id="3-cli-wrapper"><strong>3. CLI wrapper.</strong></h3>
<p>I built a wrapper around yt-dlp which essentially parameterizes the calls and formats the lines extracted from std-otut into json format with a couple of regexps so I can easily work with this in the future.</p>
<p><strong>Events:</strong> The wrapper throws 4 types of events:</p>
<ul>
<li>start - when a download starts</li>
<li>progress - information about the download progress (precent, speed..)</li>
<li>error - if something went wrong</li>
<li>close - if the process has ended</li>
</ul>
<p>Wrapper file: <a href="https://github.com/MaurerKrisztian/youtube-downloader-api/blob/main/src/cli-wrapper/yt-downloader-wrapper.ts">https://github.com/MaurerKrisztian/youtube-downloader-api/blob/main/src/cli-wrapper/yt-downloader-wrapper.ts</a></p>
<p>As a result, this function call can be used to start a download of throw events from cli responses into a processable format:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"></span>
<span class="line"><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">process</span><span style="color: #C9D1D9">(link: string, id: string, path: string </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'./download'</span><span style="color: #C9D1D9">, filename: string </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">"video"</span><span style="color: #C9D1D9">, format: </span><span style="color: #A5D6FF">'mp4'</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">|</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'mp3'</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'mp4'</span><span style="color: #C9D1D9">) {</span><span style="color: #FF7B72">...</span><span style="color: #C9D1D9">}</span></span>
<span class="line"></span></code></pre>
<h3 id="4-event-management"><strong>4. Event management</strong></h3>
<p>On the UI, the goal would be to have real-time feedback, so a REST API solution is not suitable, but the websocket is perfet, so I built a socket connection, the client can request a download and can subscribe to progress, error, done response that sends real time information.</p>
<h3 id="5-ui"><strong>5. UI</strong></h3>
<p>I’m writing UI in Vue (my first vue project). It essentially connects to the backend sockets and displays the returned data.</p>
<h3 id="6-deploy"><strong>6. Deploy</strong></h3>
<p>We use the yt-dlp cli so the env need to contain this. I was able to deploy it to my own server, but I also tried to deploy here <a href="https://railway.app/">https://railway.app/</a> but this yt-dlp is a “banned dependency” due to the quality of shared hosting but we can include the yt-dlp binary among the files and use that or downolad the binary on the fly. I am currently working on it.</p>
<p>*NOTE: this is just an mvp (there are things to improve) in the future I will update the article and the project, if you find something to improve, feel free to submit a pull request or open an issue</p></div>
		</div>
		<footer class="tac mt6 astro-FNBAIWJC">
			<a href="/projects" class="astro-FNBAIWJC">
				<span class="_button_1fbb5_1">View More</span>
			</a>
		</footer>
		<footer class="_footer_knfx6_1">© 2022 Maurer Krisztián<small class="_byline_knfx6_9">🚀 Built by Astro</small></footer>
	</body></html>